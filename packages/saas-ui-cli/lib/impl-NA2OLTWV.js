import{a as b,d as R}from"./chunk-HJHLLVWT.js";import"./chunk-VJEAJKHP.js";import"./chunk-VAIDCNBY.js";import{a as y}from"./chunk-RY4V5ZEE.js";import{a as h,b as d,f as g,i as o,j as l}from"./chunk-TLFJOCN6.js";import"./chunk-P2LI7GSR.js";import"./chunk-RWM7Q2YQ.js";import O from"kleur";import C from"path";import $ from"prompts";import{z as s}from"zod";import p from"fs-extra";import f from"path";async function k(n){let c={};if(!p.existsSync(n.cwd))return c["1"]=!0,{errors:c,config:null};let r=await h(n.cwd);if(o.debug(`Monorepo detected: ${r.isMonorepo}`),r.isMonorepo&&(o.debug(`Monorepo type: ${r.type}`),o.debug(`Monorepo root: ${r.root}`)),!p.existsSync(f.resolve(n.cwd,"package.json")))return c["1"]=!0,o.debug(`No package.json found in ${n.cwd}`),{errors:c,config:null};let i=f.resolve(n.cwd,"components.json"),e=n.cwd;if(o.debug(`Looking for components.json at: ${i}`),!p.existsSync(i)&&r.isMonorepo){o.debug("Not found in cwd, checking monorepo locations...");let a=f.join(n.cwd,"packages","ui","components.json");if(o.debug(`Checking: ${a}`),p.existsSync(a))i=a,e=f.join(n.cwd,"packages","ui"),o.debug(`Found components.json in UI package, using: ${e}`);else if(r.root){let t=f.join(r.root,"packages","ui","components.json");o.debug(`Checking from root: ${t}`),p.existsSync(t)&&(i=t,e=f.join(r.root,"packages","ui"),o.debug(`Found components.json in UI package from root, using: ${e}`))}}if(!p.existsSync(i))return c["3"]=!0,o.debug("components.json not found at any location"),{errors:c,config:null};o.debug(`components.json found at: ${i}`),o.debug(`Using cwd: ${e}`),n.cwd=e;try{let a=await g(n.cwd);return{errors:c,config:a}}catch(a){o.debug(a),console.log(a),o.break(),o.error(`An invalid ${d.info("components.json")} file was found at ${d.info(n.cwd)}.
Before you can add components, you must create a valid ${d.info("components.json")} file by running the ${d.info("init")} command.`),o.error(`Learn more at ${d.info("https://saas-ui.dev/docs/components-json")}.`),o.break(),process.exit(1)}}var j=s.object({yes:s.boolean(),overwrite:s.boolean(),cwd:s.string().optional(),all:s.boolean(),path:s.string().optional(),silent:s.boolean(),srcDir:s.boolean().optional()}),I=j.extend({components:s.array(s.string()).optional()});async function Q(n,...c){try{let r=c.map(m=>m.includes("/")&&!m.startsWith("@")?`@${m}`:m),i=I.parse({...n,components:r??[]}),e={...i,cwd:C.resolve(i.cwd??process.cwd())},a=e.cwd,t=await k(e);e.components?.length||(e.components=await E(e,e)),e.cwd!==a&&(o.info(`Detected monorepo. Adding components to ${d.info("packages/ui/")}`),o.break());let u=t.config;if(t.errors["3"]){let{proceed:m}=await $({type:"confirm",name:"proceed",message:`You need to create a ${d.info("components.json")} file to add components. Proceed?`,initial:!0});m||(o.break(),process.exit(1)),u=await R({cwd:e.cwd,yes:!0,force:!0,defaults:!1,skipPreflight:!1,silent:!0,isNewProject:!1,monorepo:!1})}if(!u)throw new Error(`Failed to read config at ${d.info(e.cwd)}.`);await b(e.components,u,e)}catch(r){o.break(),l(r)}}async function E(n,c){if(!await g(c.cwd))return o.break(),l(new Error("Failed to read config.")),[];let i=await y();if(!i)return o.break(),l(new Error("Failed to fetch registry index.")),[];if(n.all)return i.map(t=>t.name);if(n.components?.length)return n.components;let{components:e}=await $({type:"autocompleteMultiselect",name:"components",message:"Which components would you like to add?",hint:"Space to select. A to toggle all. Enter to submit.",instructions:!1,choices:i.filter(t=>t.type==="registry:block").map(t=>({title:`${t.category}/${t.subcategory}/${t.name} ${t.private?O.blue(O.bold("(PRO)")):""}`,value:t.name,selected:n.all?!0:n.components?.includes(t.name)}))});e?.length||(o.warn("No components selected. Exiting."),o.info(""),process.exit(1));let a=s.array(s.string()).safeParse(e);return a.success?a.data:(o.error(""),l(new Error("Something went wrong. Please try again.")),[])}export{Q as add,j as addOptionsFlagsSchema};
