import{a as h,d as y}from"./chunk-BMWB2L7U.js";import{a as g,f as u}from"./chunk-GCJCPTHU.js";import{a as c,b as o,c as f,d as w}from"./chunk-SEFHISUN.js";import"./chunk-L36FRG6H.js";import S from"kleur";import x from"path";import k from"prompts";import{z as s}from"zod";import p from"fs-extra";import m from"path";async function R(n){let i={};if(!p.existsSync(n.cwd))return i["1"]=!0,{errors:i,config:null};let r=await g(n.cwd);if(o.debug(`Monorepo detected: ${r.isMonorepo}`),r.isMonorepo&&(o.debug(`Monorepo type: ${r.type}`),o.debug(`Monorepo root: ${r.root}`)),!p.existsSync(m.resolve(n.cwd,"package.json")))return i["1"]=!0,o.debug(`No package.json found in ${n.cwd}`),{errors:i,config:null};let e=m.resolve(n.cwd,"components.json"),t=n.cwd;if(o.debug(`Looking for components.json at: ${e}`),!p.existsSync(e)&&r.isMonorepo){o.debug("Not found in cwd, checking monorepo locations...");let a=m.join(n.cwd,"packages","ui","components.json");if(o.debug(`Checking: ${a}`),p.existsSync(a))e=a,t=m.join(n.cwd,"packages","ui"),o.debug(`Found components.json in UI package, using: ${t}`);else if(r.root){let d=m.join(r.root,"packages","ui","components.json");o.debug(`Checking from root: ${d}`),p.existsSync(d)&&(e=d,t=m.join(r.root,"packages","ui"),o.debug(`Found components.json in UI package from root, using: ${t}`))}}if(!p.existsSync(e))return i["3"]=!0,o.debug("components.json not found at any location"),{errors:i,config:null};o.debug(`components.json found at: ${e}`),o.debug(`Using cwd: ${t}`),n.cwd=t;try{let a=await u(n.cwd);return{errors:i,config:a}}catch(a){o.debug(a),console.log(a),o.break(),o.error(`An invalid ${c.info("components.json")} file was found at ${c.info(n.cwd)}.
Before you can add components, you must create a valid ${c.info("components.json")} file by running the ${c.info("init")} command.`),o.error(`Learn more at ${c.info("https://saas-ui.dev/docs/components-json")}.`),o.break(),process.exit(1)}}var j=s.object({yes:s.boolean(),overwrite:s.boolean(),cwd:s.string().optional(),all:s.boolean(),path:s.string().optional(),silent:s.boolean(),srcDir:s.boolean().optional()}),I=j.extend({components:s.array(s.string()).optional()});async function H(n,...i){try{let r=I.parse({...n,components:i??[]}),e={...r,cwd:x.resolve(r.cwd??process.cwd())};e.components?.length||(e.components=await C(e));let t=e.cwd,a=await R(e);e.cwd!==t&&(o.info(`Detected monorepo. Adding components to ${c.info("packages/ui/")}`),o.break());let d=a.config;if(a.errors["3"]){let{proceed:O}=await k({type:"confirm",name:"proceed",message:`You need to create a ${c.info("components.json")} file to add components. Proceed?`,initial:!0});O||(o.break(),process.exit(1)),d=await y({cwd:e.cwd,yes:!0,force:!0,defaults:!1,skipPreflight:!1,silent:!0,isNewProject:!1})}if(!d)throw new Error(`Failed to read config at ${c.info(e.cwd)}.`);await h(e.components,d,e)}catch(r){o.break(),f(r)}}async function C(n){let i=await w();if(!i)return o.break(),f(new Error("Failed to fetch registry index.")),[];if(n.all)return i.map(t=>t.name);if(n.components?.length)return n.components;let{components:r}=await k({type:"autocompleteMultiselect",name:"components",message:"Which components would you like to add?",hint:"Space to select. A to toggle all. Enter to submit.",instructions:!1,choices:i.filter(t=>t.type==="registry:block").map(t=>({title:`${t.category}/${t.subcategory}/${t.name} ${t.private?S.blue(S.bold("(PRO)")):""}`,value:t.name,selected:n.all?!0:n.components?.includes(t.name)}))});r?.length||(o.warn("No components selected. Exiting."),o.info(""),process.exit(1));let e=s.array(s.string()).safeParse(r);return e.success?e.data:(o.error(""),f(new Error("Something went wrong. Please try again.")),[])}export{H as add,j as addOptionsFlagsSchema};
//# sourceMappingURL=impl-2QRAZHYR.js.map