{"version":3,"sources":["../src/commands/list/impl.ts"],"sourcesContent":["import Table from 'cli-table3'\nimport kleur from 'kleur'\nimport path from 'node:path'\nimport z from 'zod'\n\nimport type { LocalContext } from '#context'\nimport { getConfig } from '#utils/get-config.js'\nimport { handleError } from '#utils/handle-error'\nimport { logger } from '#utils/logger'\nimport { getRegistryIndex } from '#utils/registry'\n\nconst listOptionsSchema = z.object({\n  category: z.string().optional(),\n  search: z.string().optional(),\n  cwd: z.string().optional(),\n})\n\ntype ListCommandFlags = z.infer<typeof listOptionsSchema>\n\nexport async function list(\n  this: LocalContext,\n  flags: ListCommandFlags,\n  ...namespaces: Array<string>\n) {\n  try {\n    const options = listOptionsSchema.parse({\n      ...flags,\n      cwd: path.resolve(flags.cwd ?? process.cwd()),\n    })\n\n    const config = await getConfig(options.cwd!)\n\n    if (!config) {\n      logger.error('Failed to fetch config.')\n      return\n    }\n\n    const namespace = namespaces?.[0]\n\n    const normalizedNamespace = namespace\n      ? namespace.startsWith('@')\n        ? namespace\n        : `@${namespace}`\n      : undefined\n\n    const parsedFlags = listOptionsSchema.parse(flags)\n    const registryIndex = await getRegistryIndex(config, normalizedNamespace)\n\n    if (!registryIndex) {\n      const namespaceMsg = normalizedNamespace\n        ? ` for namespace ${normalizedNamespace}`\n        : ''\n      logger.error(`Failed to fetch registry index${namespaceMsg}.`)\n      return\n    }\n\n    const table = new Table({\n      head: ['Name', 'Category', 'type', 'Description'],\n      colWidths: [35, 15, 20, 50],\n      style: {\n        head: ['cyan'],\n        border: ['gray'],\n      },\n    })\n\n    let components = registryIndex.filter((component) =>\n      ['registry:block', 'registry:ui'].includes(component.type),\n    )\n\n    if (parsedFlags.category) {\n      components = components.filter((component) =>\n        component.subcategory\n          ?.toLowerCase()\n          .includes(parsedFlags.category!.toLowerCase()),\n      )\n    }\n\n    if (parsedFlags.search) {\n      const searchTerm = parsedFlags.search.toLowerCase()\n      components = components.filter(\n        (component) =>\n          component.name.toLowerCase().includes(searchTerm) ||\n          component.description?.toLowerCase().includes(searchTerm) ||\n          component.category?.toLowerCase().includes(searchTerm) ||\n          component.subcategory?.toLowerCase().includes(searchTerm),\n      )\n    }\n\n    components = components.sort((a, b) => {\n      if (a.subcategory !== b.subcategory) {\n        return a.subcategory?.localeCompare(b.subcategory || '') || 0\n      }\n      return a.name.localeCompare(b.name)\n    })\n\n    for (const component of components) {\n      const name = component.private\n        ? `${component.name} ${kleur.blue(kleur.bold('(PRO)'))}`\n        : component.name\n\n      table.push([\n        name,\n        component.subcategory || '-',\n        component.type || '-',\n        component.description || '-',\n      ])\n    }\n\n    logger.log('')\n\n    let title = 'Available Components'\n    if (normalizedNamespace) {\n      title += ` from ${kleur.cyan(normalizedNamespace)}`\n    }\n    title += ':'\n\n    const filters = []\n    if (parsedFlags.category) {\n      filters.push(`subcategory: ${parsedFlags.category}`)\n    }\n    if (parsedFlags.search) {\n      filters.push(`search: \"${parsedFlags.search}\"`)\n    }\n\n    if (filters.length > 0) {\n      title = title.slice(0, -1)\n      title += ` (filtered by ${filters.join(', ')}):`\n    }\n\n    logger.log(kleur.bold(title))\n    logger.log('')\n    logger.log(table.toString())\n    logger.log('')\n    logger.log(`Total: ${kleur.green(components.length)} components`)\n    logger.log('')\n  } catch (error) {\n    handleError(error)\n  }\n}\n"],"mappings":"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","names":["Table","kleur","path","z","listOptionsSchema","z","list","flags","namespaces","options","path","config","getConfig","logger","namespace","normalizedNamespace","parsedFlags","registryIndex","getRegistryIndex","namespaceMsg","table","Table","components","component","searchTerm","a","b","name","kleur","title","filters","error","handleError"]}