import{c as u}from"./chunk-RIVI6ZUL.js";import{serve as b}from"@hono/node-server";import{Hono as A}from"hono";import{cors as k}from"hono/cors";import x from"open";import L from"ora";import{createClient as h}from"@supabase/supabase-js";function f(n){return h("fff","",{global:{headers:{Authorization:`Bearer ${n}`}}})}import{readFileSync as P,writeFileSync as m}from"fs";import d from"os";import y from"path";var w=".saas-ui";async function g(n){try{let t=d.homedir(),o=y.join(t,w);m(o,JSON.stringify(n))}catch(t){console.error("Error writing to local config file",t)}}async function z(){let n=new Promise((o,s)=>{let r=new A,a;r.use(k({origin:u,allowMethods:["GET"],allowHeaders:["Authorization"]})),r.use("/callback",async(e,l)=>{await l(),o({token:a})}),r.get("/callback",async e=>{let l=e.req.header("Authorization");return l?(a=l.split(" ")[1],a?e.json({success:!0},200):e.json({success:!1,error:"No token provided"},400)):e.json({success:!1,error:"No authorization header provided"},400)}),r.get("/success",async e=>e.text("Login successful, you can close this tab.")),r.get("/cancel",async e=>(s(new Error("Login cancelled")),e.text("Login cancelled, you can close this tab."))),r.get("/error",async e=>(s(new Error("Login error")),e.text("Login failed, you can close this tab.")));let p=b({fetch:r.fetch,hostname:"localhost"});p.listen();let i=p.address(),c;if(!i){s(new Error("Failed to start server"));return}typeof i=="string"?c=parseInt(i.split(":")[2]??""):c=i.port,x(`${u}/login?callbackPort=${c}`),console.log(`If nothing happens, open the following URL in your browser: ${u}/login?callbackPort=${c}`)}),t=L({text:"Authenticating...",color:"green"});try{t.start();let o=await n;if(t.stop(),!o.token){console.error("Failed to authenticate, please try again.");return}let s=f(o.token),{data:r,error:a}=await s.auth.getUser();if(a){console.error("Failed to authenticate, please try again.");return}console.log(`Hi ${r.user.email}, you are now logged in.`),g({token:o.token})}catch(o){t.stop(),console.error(o)}}export{z as login};
//# sourceMappingURL=impl-WHK76LUL.js.map