import{a as _}from"./chunk-RIVI6ZUL.js";import{e as C}from"./chunk-FW7US4TT.js";import{HttpsProxyAgent as H}from"https-proxy-agent";import j from"node-fetch";import{promises as P}from"fs";import{z as m}from"zod";function l(t){return t.replace(/\${(\w+)}/g,(r,e)=>process.env[e]||"")}import{z as U}from"zod";var g={NETWORK_ERROR:"NETWORK_ERROR",NOT_FOUND:"NOT_FOUND",UNAUTHORIZED:"UNAUTHORIZED",FORBIDDEN:"FORBIDDEN",FETCH_ERROR:"FETCH_ERROR",NOT_CONFIGURED:"NOT_CONFIGURED",INVALID_CONFIG:"INVALID_CONFIG",MISSING_ENV_VARS:"MISSING_ENV_VARS",LOCAL_FILE_ERROR:"LOCAL_FILE_ERROR",PARSE_ERROR:"PARSE_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},u=class extends Error{code;statusCode;context;suggestion;timestamp;cause;constructor(r,e={}){super(r),this.name="RegistryError",this.code=e.code||g.UNKNOWN_ERROR,this.statusCode=e.statusCode,this.cause=e.cause,this.context=e.context,this.suggestion=e.suggestion,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},f=class extends u{constructor(e,n){let s=`The item at ${e} was not found. It may not exist at the registry.`;super(s,{code:g.NOT_FOUND,statusCode:404,cause:n,context:{url:e},suggestion:"Check if the item name is correct and the registry URL is accessible."});this.url=e;this.name="RegistryNotFoundError"}},y=class extends u{constructor(e,n){let s=`You are not authorized to access the item at ${e}. If this is a remote registry, you may need to authenticate.`;super(s,{code:g.UNAUTHORIZED,statusCode:401,cause:n,context:{url:e},suggestion:"Check your authentication credentials and environment variables."});this.url=e;this.name="RegistryUnauthorizedError"}},h=class extends u{constructor(e,n){let s=`You are not authorized to access the item at ${e}. If this is a remote registry, you may need to authenticate.`;super(s,{code:g.FORBIDDEN,statusCode:403,cause:n,context:{url:e},suggestion:"Check your authentication credentials and environment variables."});this.url=e;this.name="RegistryForbiddenError"}},E=class extends u{constructor(e,n,s,o){let c=n?`Failed to fetch from registry (${n}): ${e}`:`Failed to fetch from registry: ${e}`,i=typeof o=="string"&&o?`${c} - ${o}`:c,a="Check your network connection and try again.";n===404?a="The requested resource was not found. Check the URL or item name.":n===500?a="The registry server encountered an error. Try again later.":n&&n>=400&&n<500&&(a="There was a client error. Check your request parameters.");super(i,{code:g.FETCH_ERROR,statusCode:n,cause:o,context:{url:e,responseBody:s},suggestion:a});this.url=e;this.responseBody=s;this.name="RegistryFetchError"}},R=class extends u{constructor(e){let n=e?`Unknown registry "${e}". Make sure it is defined in components.json as follows:
{
  "registries": {
    "${e}": "[URL_TO_REGISTRY]"
  }
}`:'Unknown registry. Make sure it is defined in components.json under "registries".';super(n,{code:g.NOT_CONFIGURED,context:{registryName:e},suggestion:"Add the registry configuration to your components.json file."});this.registryName=e;this.name="RegistryNotConfiguredError"}},x=class extends u{constructor(e,n){super(`Failed to read local registry file: ${e}`,{code:g.LOCAL_FILE_ERROR,cause:n,context:{filePath:e},suggestion:"Check if the file exists and you have read permissions."});this.filePath=e;this.name="RegistryLocalFileError"}},p=class extends u{constructor(e,n){let s=`Failed to parse registry item: ${e}`;n instanceof U.ZodError&&(s=`Failed to parse registry item: ${e}
${n.message}`);super(s,{code:g.PARSE_ERROR,cause:n,context:{item:e},suggestion:"The registry item may be corrupted or have an invalid format."});this.item=e;this.parseError=n,this.name="RegistryParseError"}parseError};var $=/^(@[a-zA-Z0-9](?:[a-zA-Z0-9-_]*[a-zA-Z0-9])?)\/(.+)$/;function I(t){if(!t.startsWith("@"))return{registry:null,item:t};let r=t.match($);return r?{registry:r[1],item:r[2]}:{registry:null,item:t}}function F(t){try{return new URL(t),!0}catch{return!1}}function Y(t){return t.startsWith(".")||t.startsWith("/")}var A="{name}",O="{style}",b=/\${(\w+)}/g;function ee(t,r){let{registry:e,item:n}=I(t);if(!e||!n)return null;let o=(r?.registries||{})[e];if(!o)throw new R(e);let c=S(n,o,r);if(!c)throw new R(e);return{url:c,headers:v(o)}}function S(t,r,e){if(!r)return null;if(typeof r=="string"){let s=r.replace(A,t);return e?.style&&s.includes(O)&&(s=s.replace(O,e.style)),l(s)}let n=r.url.replace(A,t);return e?.style&&n.includes(O)&&(n=n.replace(O,e.style)),n=l(n),r.params?D(n,r.params):n}function v(t){if(typeof t=="string"||!t.headers)return{};let r={};for(let[e,n]of Object.entries(t.headers)){let s=l(n);V(n,s)&&(r[e]=s)}return r}function D(t,r){let e=new URLSearchParams;for(let[o,c]of Object.entries(r)){let i=l(c);i&&e.append(o,i)}let n=e.toString();if(!n)return t;let s=t.includes("?")?"&":"?";return`${t}${s}${n}`}function V(t,r){let e=r.trim();if(!e)return!1;if(t.includes("${")&&t.match(b)){let s=t.replace(b,"").trim();return e!==s}return!0}function T(t){if(F(t)){let r=new URL(t);return r.pathname.match(/\/chat\/b\//)&&!r.pathname.endsWith("/json")&&(r.pathname=`${r.pathname}/json`),r.toString()}return`${_}/${t}`}var w={headers:{}};function re(t){w.headers={...w.headers,...t}}function k(t){return w.headers[t]||{}}function ne(){w.headers={}}var G=process.env.https_proxy?new H(process.env.https_proxy):void 0,N=new Map;function pe(){N.clear()}async function me(t,r={}){return r={useCache:!0,...r},await Promise.all(t.map(async n=>{let s=T(n);if(r.useCache&&N.has(s))return N.get(s);let o=(async()=>{let c=k(s),i=await j(s,{agent:G,headers:{...c}});if(!i.ok){let a;if(i.headers.get("content-type")?.includes("application/json")){let L=await i.json(),d=m.object({detail:m.string().optional(),title:m.string().optional(),message:m.string().optional(),error:m.string().optional()}).safeParse(L);d.success&&(a=d.data.detail||d.data.message,d.data.error&&(a=`[${d.data.error}] ${a}`))}throw i.status===401?new y(s,a):i.status===404?new f(s,a):i.status===403?new h(s,a):new E(s,i.status,void 0,a)}return i.json()})();return r.useCache&&N.set(s,o),o}))}async function fe(t){try{let r=await P.readFile(t,"utf-8"),e=JSON.parse(r);try{return C.parse(e)}catch(n){throw new p(t,n)}}catch(r){throw r instanceof p?r:new x(t,r)}}export{l as a,R as b,p as c,I as d,F as e,Y as f,ee as g,v as h,re as i,ne as j,pe as k,me as l,fe as m};
//# sourceMappingURL=chunk-AKZB7BS6.js.map