{"version":3,"sources":["../src/utils/detect-monorepo.ts","../src/utils/highlighter.ts","../src/utils/get-config.ts","../src/utils/resolve-import.ts","../src/utils/logger.ts","../src/utils/handle-error.ts"],"sourcesContent":["import { existsSync, readFileSync } from 'node:fs'\nimport path from 'node:path'\n\nexport interface MonorepoInfo {\n  isMonorepo: boolean\n  root?: string\n  packageName?: string\n  type?: 'turborepo' | 'pnpm' | 'yarn' | 'npm'\n}\n\nexport async function detectMonorepo(cwd: string): Promise<MonorepoInfo> {\n  const packageJsonPath = path.join(cwd, 'package.json')\n\n  if (!existsSync(packageJsonPath)) {\n    return { isMonorepo: false }\n  }\n\n  const packageJson = JSON.parse(readFileSync(packageJsonPath, 'utf8'))\n  const packageName = packageJson.name\n\n  const isWorkspacePackage = packageName && /^@[^/]+\\/[^/]+/.test(packageName)\n\n  let currentDir = cwd\n  let depth = 0\n  const maxDepth = 5\n\n  while (depth < maxDepth) {\n    if (existsSync(path.join(currentDir, 'turbo.json'))) {\n      return {\n        isMonorepo: true,\n        root: currentDir,\n        packageName,\n        type: 'turborepo',\n      }\n    }\n\n    if (existsSync(path.join(currentDir, 'pnpm-workspace.yaml'))) {\n      return {\n        isMonorepo: true,\n        root: currentDir,\n        packageName,\n        type: 'pnpm',\n      }\n    }\n\n    const rootPackageJsonPath = path.join(currentDir, 'package.json')\n    if (existsSync(rootPackageJsonPath) && currentDir !== cwd) {\n      try {\n        const rootPackageJson = JSON.parse(\n          readFileSync(rootPackageJsonPath, 'utf8'),\n        )\n        if (rootPackageJson.workspaces) {\n          return {\n            isMonorepo: true,\n            root: currentDir,\n            packageName,\n            type: Array.isArray(rootPackageJson.workspaces) ? 'npm' : 'yarn',\n          }\n        }\n      } catch {\n        continue\n      }\n    }\n\n    const parentDir = path.dirname(currentDir)\n    if (parentDir === currentDir) break\n    currentDir = parentDir\n    depth++\n  }\n\n  if (isWorkspacePackage) {\n    return {\n      isMonorepo: true,\n      packageName,\n    }\n  }\n\n  return { isMonorepo: false }\n}\n\nexport function hasMonorepoAliases(aliases: Record<string, string>): boolean {\n  const values = Object.values(aliases)\n  return values.some((value) => /^@[^/]+\\/[^/]+/.test(value))\n}\n\nexport function getMonorepoPackagePrefix(\n  aliases: Record<string, string>,\n): string | null {\n  for (const value of Object.values(aliases)) {\n    const match = value.match(/^(@[^/]+\\/[^/]+)/)\n    if (match && match[1]) {\n      return match[1]\n    }\n  }\n  return null\n}\n\nexport function monorepoAliasToPath(\n  alias: string,\n  packagePrefix: string,\n): string {\n  const relativePath = alias.replace(packagePrefix, '')\n\n  if (relativePath.startsWith('/')) {\n    return `./src${relativePath}`\n  }\n\n  return `./src/${relativePath}`\n}\n","import { cyan, green, red, yellow } from 'kleur/colors'\r\n\r\nexport const highlighter = {\r\n  error: red,\r\n  warn: yellow,\r\n  info: cyan,\r\n  success: green,\r\n}\r\n","import { cosmiconfig } from 'cosmiconfig'\nimport path from 'node:path'\nimport { loadConfig } from 'tsconfig-paths'\nimport { z } from 'zod'\n\nimport { detectMonorepo, hasMonorepoAliases } from '#utils/detect-monorepo'\nimport { highlighter } from '#utils/highlighter'\nimport { resolveImport } from '#utils/resolve-import'\n\nexport const DEFAULT_STYLE = 'default'\nexport const DEFAULT_COMPONENTS = '@/components'\nexport const DEFAULT_UTILS = '@/lib/utils'\n\n// TODO: Figure out if we want to support all cosmiconfig formats.\n// A simple components.json file would be nice.\nconst explorer = cosmiconfig('components', {\n  searchPlaces: ['components.json'],\n})\n\nexport const rawConfigSchema = z\n  .object({\n    $schema: z.string().optional(),\n    system: z.string().optional().default('chakra'),\n    style: z.string().optional().default('default'),\n    rsc: z.coerce.boolean().default(false),\n    tsx: z.coerce.boolean().default(true),\n    registries: z\n      .record(\n        z.string(),\n        z.union([\n          z.string(),\n          z.object({\n            url: z.string(),\n            headers: z.record(z.string(), z.string()).optional(),\n            params: z.record(z.string(), z.string()).optional(),\n          }),\n        ]),\n      )\n      .optional(),\n    // theme: z.object({\n    //   config: z.string(),\n    // }),\n    aliases: z.object({\n      components: z.string(),\n      utils: z.string(),\n      ui: z.string().optional(),\n      lib: z.string().optional(),\n      hooks: z.string().optional(),\n    }),\n  })\n  .strict()\n\nexport type RawConfig = z.infer<typeof rawConfigSchema>\n\nexport const configSchema = rawConfigSchema.extend({\n  resolvedPaths: z.object({\n    cwd: z.string(),\n    utils: z.string(),\n    components: z.string(),\n    lib: z.string(),\n    hooks: z.string(),\n    ui: z.string(),\n  }),\n})\n\nexport type Config = z.infer<typeof configSchema>\n\nexport async function getConfig(cwd: string) {\n  const config = await getRawConfig(cwd)\n\n  if (!config) {\n    return null\n  }\n\n  return await resolveConfigPaths(cwd, config)\n}\n\nexport async function resolveConfigPaths(cwd: string, config: RawConfig) {\n  const monorepoInfo = await detectMonorepo(cwd)\n  const isMonorepo =\n    monorepoInfo.isMonorepo || hasMonorepoAliases(config.aliases)\n\n  const tsConfig = loadConfig(cwd)\n\n  if (tsConfig.resultType === 'failed') {\n    throw new Error(\n      `Failed to load ${config.tsx ? 'tsconfig' : 'jsconfig'}.json. ${\n        tsConfig.message ?? ''\n      }`.trim(),\n    )\n  }\n\n  const resolveAlias = async (alias: string): Promise<string> => {\n    if (isMonorepo && /^@[^/]+\\/[^/]+/.test(alias)) {\n      const match = alias.match(/^@[^/]+\\/[^/]+\\/(.+)$/)\n      if (match && match[1]) {\n        const relativePath = match[1]\n        return path.resolve(cwd, 'src', relativePath)\n      }\n      return path.resolve(cwd, 'src')\n    }\n\n    const resolved = await resolveImport(alias, tsConfig)\n    return resolved ?? path.resolve(cwd, 'src')\n  }\n\n  return configSchema.parse({\n    ...config,\n    resolvedPaths: {\n      cwd,\n      utils: await resolveAlias(config.aliases['utils']),\n      components: await resolveAlias(config.aliases['components']),\n      ui: config.aliases['ui']\n        ? await resolveAlias(config.aliases['ui'])\n        : path.resolve(await resolveAlias(config.aliases['components']), 'ui'),\n      lib: config.aliases['lib']\n        ? await resolveAlias(config.aliases['lib'])\n        : path.resolve(await resolveAlias(config.aliases['utils']), '..'),\n      hooks: config.aliases['hooks']\n        ? await resolveAlias(config.aliases['hooks'])\n        : path.resolve(\n            await resolveAlias(config.aliases['components']),\n            '..',\n            'hooks',\n          ),\n    },\n  })\n}\n\nexport async function getRawConfig(cwd: string): Promise<RawConfig | null> {\n  try {\n    const configResult = await explorer.search(cwd)\n\n    if (!configResult) {\n      return null\n    }\n\n    return rawConfigSchema.parse(configResult.config)\n  } catch (error) {\n    const componentPath = `${cwd}/components.json`\n    throw new Error(\n      `Invalid configuration found in ${highlighter.info(componentPath)}.`,\n    )\n  }\n}\n","import { type ConfigLoaderSuccessResult, createMatchPath } from 'tsconfig-paths'\r\n\r\nexport async function resolveImport(\r\n  importPath: string,\r\n  config: Pick<ConfigLoaderSuccessResult, 'absoluteBaseUrl' | 'paths'>,\r\n) {\r\n  return createMatchPath(config.absoluteBaseUrl, config.paths)(\r\n    importPath,\r\n    undefined,\r\n    () => true,\r\n    ['.ts', '.tsx'],\r\n  )\r\n}\r\n","import { highlighter } from '#utils/highlighter'\r\n\r\nexport const logger = {\r\n  error(...args: unknown[]) {\r\n    console.log(highlighter.error(args.join(' ')))\r\n  },\r\n  warn(...args: unknown[]) {\r\n    console.log(highlighter.warn(args.join(' ')))\r\n  },\r\n  info(...args: unknown[]) {\r\n    console.log(highlighter.info(args.join(' ')))\r\n  },\r\n  success(...args: unknown[]) {\r\n    console.log(highlighter.success(args.join(' ')))\r\n  },\r\n  debug(...args: unknown[]) {\r\n    if (process.env.DEBUG) {\r\n      console.log(args.join(' '))\r\n    }\r\n  },\r\n  log(...args: unknown[]) {\r\n    console.log(args.join(' '))\r\n  },\r\n  break() {\r\n    console.log('')\r\n  },\r\n}\r\n","import { z } from 'zod'\r\n\r\nimport { highlighter } from '#utils/highlighter'\r\nimport { logger } from '#utils/logger'\r\n\r\nexport function handleError(error: unknown) {\r\n  logger.error(\r\n    `Something went wrong. Please check the error below for more details.`,\r\n  )\r\n  logger.error(`If the problem persists, please open an issue on GitHub.`)\r\n  logger.error('')\r\n  if (typeof error === 'string') {\r\n    logger.error(error)\r\n    logger.break()\r\n    process.exit(1)\r\n  }\r\n\r\n  if (error instanceof z.ZodError) {\r\n    logger.error('Validation failed:')\r\n    const obj = Object.entries(error.flatten().fieldErrors)\r\n    if (obj.length > 0) {\r\n      for (const [key, value] of obj) {\r\n        logger.error(`- ${highlighter.info(key)}: ${value}`)\r\n      }\r\n    } else {\r\n      logger.error(error.message)\r\n    }\r\n    logger.break()\r\n    process.exit(1)\r\n  }\r\n\r\n  if (error instanceof Error) {\r\n    logger.error(error.message)\r\n    logger.break()\r\n    process.exit(1)\r\n  }\r\n\r\n  logger.break()\r\n  process.exit(1)\r\n}\r\n"],"mappings":"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","names":["existsSync","readFileSync","path","detectMonorepo","cwd","packageJsonPath","packageName","isWorkspacePackage","currentDir","depth","maxDepth","rootPackageJsonPath","rootPackageJson","parentDir","hasMonorepoAliases","aliases","value","cyan","green","red","yellow","highlighter","cosmiconfig","path","loadConfig","z","createMatchPath","resolveImport","importPath","config","DEFAULT_COMPONENTS","DEFAULT_UTILS","explorer","cosmiconfig","rawConfigSchema","z","configSchema","getConfig","cwd","config","getRawConfig","resolveConfigPaths","isMonorepo","detectMonorepo","hasMonorepoAliases","tsConfig","loadConfig","resolveAlias","alias","match","relativePath","path","resolveImport","configResult","componentPath","highlighter","logger","args","highlighter","z","handleError","error","logger","z","obj","key","value","highlighter"]}